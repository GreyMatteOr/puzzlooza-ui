(this.webpackJsonpui=this.webpackJsonpui||[]).push([[0],{48:function(t,e,n){},80:function(t,e,n){},81:function(t,e,n){},85:function(t,e,n){},86:function(t,e,n){"use strict";n.r(e);var o=n(0),r=n(10),a=n(11),i=n(13),c=n(12),s=(n(48),n(43)),u=n.n(s),l=n(1),p=n(7),d=n(45),f=n(2),h=n.n(f),g=(n(80),n.p+"static/media/rainbow.ccc2084b.jpg"),m=!1,v=[0,0],b={},y=void 0!==window.ontouchstart,j=function(t,e,n,o,r){m||(document.addEventListener(y?"touchmove":"mousemove",(function(t){var e=t;t.touches&&(e=t.touches[0]),v=[e.clientX,e.clientY],Object.entries(b).forEach((function(t){var n=Object(p.a)(t,2);n[0];(0,n[1])(e.clientX,e.clientY)}))})),n.on("rotate",O),document.addEventListener("keydown",(function(t){var e,o;"KeyZ"===t.code&&O((e=document).elementFromPoint.apply(e,Object(l.a)(v)).id,1,n),"KeyX"===t.code&&O((o=document).elementFromPoint.apply(o,Object(l.a)(v)).id,-1,n)}))),m=!0;var a=!1,i=!1,c=0,s=0,u=0,d=0;function f(e){if(e.stopPropagation(),e.preventDefault(),"false"!==t.dataset.dragEnabled){var n=e;e.touches&&(n=e.touches[0]),a=!0,c=t.offsetLeft-n.clientX,s=t.offsetTop-n.clientY}}return e.addEventListener(y?"touchstart":"mousedown",f),t.addEventListener(y?"touchend":"mouseup",(function(){a=!1,i=!1,r&&r(t,e,parseInt(t.style.left),parseInt(t.style.top))})),b[e.id]=function(e,r){if(a){if(i||(i=!0,o&&o(t,u,d)),u=e+c,d=r+s,"true"===t.dataset.dragBoundary){if(u<1||u>=window.innerWidth-t.offsetWidth)return;if(d<1||d>=window.innerHeight-t.offsetHeight)return}t.style.left=u+"px",t.style.top=d+"px",n.emit("move",t.id,u+"px",d+"px")}},function(t){t.removeEventListener("mousedown",f),delete b[t.id]}};function O(t,e,n){var o=document.getElementById(t);if(o&&o.classList.contains("tile")){n&&n.emit("rotate",t,e);var r=o.parentNode;r.dataset.rotation=parseInt(r.dataset.rotation)+e,r.style.transform="rotate(".concat(-90*r.dataset.rotation,"deg)")}}n(81);function R(t){return((t=parseInt(t))%4+4)%4}var x,w=function(t){Object(i.a)(n,t);var e=Object(c.a)(n);function n(t){var o;return Object(r.a)(this,n),(o=e.call(this,t)).checkMatch=function(t,e,n){var r,a=t.offsetHeight,i=t.offsetWidth,c=parseInt(t.style.gridColumn),s=parseInt(t.style.gridRow),u=Math.ceil(t.parentNode.offsetWidth/i),d=Math.ceil(t.parentNode.offsetHeight/a),f=function(t,e,n,o){var r=[t+o/2,e+n/2],a=t-r[0];return[e-r[1]+r[0],a+r[1]]}(e,n,t.parentNode.offsetHeight,t.parentNode.offsetWidth),h=Object(p.a)(f,2),g=h[0],m=h[1],v=R(t.parentNode.dataset.rotation),b={0:e+(c-1)*i,1:g+(s-1)*i,2:e+(u-c)*i,3:g+(d-s)*i}[v],y={0:n+(s-1)*a,1:m+(u-c)*a,2:n+(d-s)*a,3:m+(c-1)*a}[v],j={bottom:{shoveXY:[null,y+a+3],refNames:["bBL","bBR"]},left:{shoveXY:[b-i-3,null],refNames:["lBL","lTL"]},right:{shoveXY:[b+i+3,null],refNames:["rBR","rTR"]},top:{shoveXY:[null,y-a-3],refNames:["tTL","tTR"]}},O={bBL:[b+.2*i,y+(a+3)],bBR:[b+.8*i,y+(a+3)],center:[b+.5*i,y+.5*a],lBL:[b-3,y+.8*a],lTL:[b-3,y+.2*a],rBR:[b+i+1,y+.8*a],rTR:[b+i+1,y+.2*a],tTL:[b+.2*i,y-1],tTR:[b+.8*i,y-1]},x=(r=document).elementsFromPoint.apply(r,Object(l.a)(O.center));["bottom","left","right","top"].forEach((function(e){var n,r,a=j[e],i=a.shoveXY,c=a.refNames,s=O[c[0]],u=O[c[1]],p=(n=document).elementsFromPoint.apply(n,Object(l.a)(s)),d=(r=document).elementsFromPoint.apply(r,Object(l.a)(u));(p=p.filter((function(n,r){var a=d.indexOf(n);if(a>=0){var c;if(x.includes(n))(c=o).shove.apply(c,[n].concat(Object(l.a)(i)));else n.classList.contains("tile")&&o.grouping.current.id!==n.parentNode.id&&function(t,e){var n={bottom:2,left:3,right:1,top:0}[e],o={0:"top",1:"right",2:"bottom",3:"left"}[R(parseInt(t.parentNode.dataset.rotation)+n)];return t.dataset[o]}(t,e)===n.id&&R(v)===R(n.parentNode.dataset.rotation)&&o.join(t,n.parentNode);return d.splice(a,1),!1}return!0}))).concat(d).forEach((function(t){var e;return(e=o).shove.apply(e,[t].concat(Object(l.a)(i)))}))}))},o.checkOverlap=function(t,e,n,r,a){var i,c=[n+.5*e,r+.5*t],s=[[n,r+t+3],[n-e-3,r],[n+e+3,r],[n,r-t-3]];(i=document).elementsFromPoint.apply(i,c).forEach((function(t){if(t.id!==a){var e,n=Math.floor(Math.random()*s.length),r=s[n];(e=o).shove.apply(e,[t].concat(Object(l.a)(r)))}}))},o.join=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n&&o.props.client.emit("combine",o.grouping.current.id,e.id,t.id);var r=parseInt(t.style.gridColumn),a=parseInt(t.style.gridRow),i=parseInt(t.parentNode.style.left),c=parseInt(t.parentNode.style.top),s=t.id.split(",").map((function(t){return parseInt(t)})),u=Object(p.a)(s,2),d=u[0],f=u[1];Object(l.a)(e.children).forEach((function(t){for(var n=t.id.split(",").map((function(t){return parseInt(t)})),i=Object(p.a)(n,2),c=i[0],s=i[1],u=c-d+r,l=s-f+a;u<1;)o.tiles.forEach((function(t){return t.unshift(null)})),u++,r++;for(;l<1;){var h=new Array(o.tiles[0].length).fill(null);o.tiles.unshift(h),l++,a++}for(;u>o.tiles[0].length;)o.tiles.forEach((function(t){return t.push(null)}));for(;l>o.tiles.length;){var g=new Array(o.tiles[0].length).fill(null);o.tiles.push(g)}o.tiles[l-1][u-1]=t,o.grouping.current.append(e.removeChild(t)),o.unregister(t),j(o.grouping.current,t,o.props.client,(function(){return o.grouping.current.style.zIndex=1}),(function(t,e,n,r){o.checkMatch(e,n,r),o.grouping.current.style.zIndex=0}))})),o.canvas.current.style.gridColumn=r,o.canvas.current.style.gridRow=a,o.updateGrid(t,o.tiles,i,c),o.props.delete(e.id)},o.canvas=h.a.createRef(),o.grouping=o.props.groupRef,o.tiles=[],o}return Object(a.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.drawTile(this.canvas.current),this.props.funcElevator(this.grouping.current.id,this.join),this.tiles.push([this.canvas.current]),this.unregister=j(this.grouping.current,this.canvas.current,this.props.client,(function(){return t.grouping.current.style.zIndex=2}),(function(e,n,o,r){isNaN(o)&&(o=1),isNaN(r)&&(r=1),t.grouping.current.style.zIndex=0,t.checkMatch(n,o,r)}))}},{key:"drawTile",value:function(t){var e=t.getContext("2d"),n=this.props,o=n.dx,r=n.dy,a=n.image,i=n.x,c=n.y;e.drawImage(a,i,c,o,r,0,0,300,150)}},{key:"shove",value:function(t,e,n){var o=this;if(t.classList.contains("tile")&&this.grouping.current.id!==t.parentNode.id){var r=t.parentNode,a=window.innerWidth-r.offsetWidth,i=window.innerHeight-r.offsetHeight,c=parseInt(r.style.left)||1,s=parseInt(r.style.top)||1;e=null===e?c:Math.min(Math.max(e,1),a),n=null===n?s:Math.min(Math.max(n,1),i),r.style.top=n+"px",r.style.left=e+"px",window.setTimeout((function(){return o.checkOverlap(r.offsetHeight,r.offsetWidth,e,n,t.id)}),0)}}},{key:"updateGrid",value:function(t,e,n,o){for(var r=0;r<e.length;r++)for(var a=0;a<e[0].length;a++){var i=e[r][a];null!==i&&(i.style.gridColumn=a+1,i.style.gridRow=r+1)}var c=this.grouping.current.style;c.gridTemplateColumns=e[0].length,c.gridTemplateRows=e.length,c.height=100*e.length+"px",c.left=n-100*(parseInt(t.style.gridColumn)-1)+"px",c.top=o-100*(parseInt(t.style.gridRow)-1)+"px",c.width=100*e[0].length+"px"}},{key:"render",value:function(){var t=this.props.coordinates.split(",").map((function(t){return parseInt(t)})),e=Object(p.a)(t,2),n=e[0],r=e[1];return Object(o.jsx)("div",{className:"canvas-grouping","data-drag-boundary":"true","data-rotation":0,id:"".concat(n,"-").concat(r),ref:this.grouping,style:{display:"grid",gridTemplateColumns:"1",gridTemplateRows:"1"},children:Object(o.jsx)("canvas",{className:"tile","data-bottom":"".concat(n,",").concat(r+1),"data-left":"".concat(n-1,",").concat(r),"data-right":"".concat(n+1,",").concat(r),"data-top":"".concat(n,",").concat(r-1),id:this.props.coordinates,ref:this.canvas,style:{gridColumn:"1",gridRow:"1"}})})}}]),n}(f.Component),I=function(t){Object(i.a)(n,t);var e=Object(c.a)(n);function n(t){var a;return Object(r.a)(this,n),(a=e.call(this,t)).createGroups=function(t,e,n){for(var r,i,c=n.width,s=n.height,u=Math.floor(c/t),l=Math.floor(s/e),p=c%u,d=s%l,f={},g=0;g<e;g++)for(var m=0;m<t;m++){var v=h.a.createRef();p&&(r=m,p--),d&&(i=g,d--),a.groupRefs["".concat(m,"-").concat(g)]=v,f["".concat(m,"-").concat(g)]=Object(o.jsx)(w,{client:a.props.client,coordinates:"".concat(m,",").concat(g),delete:a.delete,dx:u,dy:l,funcElevator:a.saveGroupCombiner,image:n,groupRef:v,x:m*u+r,y:g*l+i},"".concat(m,",").concat(g))}a.setState({groups:f})},a.delete=function(t){var e=Object(d.a)({},a.state.groups);delete e[t],delete a.groupRefs[t],a.setState({groups:e})},a.doneLoadingPic=function(t){a.createGroups(9,6,t.target),a.setState({loadingPicture:!1}),a.props.client.on("roomData",a.arrangeGroups),a.props.client.on("dataRequest",a.sendData),a.props.client.on("newRoom",(function(){a.setState({loadingRoom:!1})})),a.props.client.on("combine",a.combineGroups),a.props.client.on("move",a.moveGroup)},a.arrangeGroups=function(t){t.forEach((function(t){var e=a.groupRefs[t.groupID].current;e.dataset.rotation=t.rotation,e.style.transform="rotate(".concat(-90*e.dataset.rotation,"deg)"),e.style.top=t.top,e.style.left=t.left;var n=t.groupID.split("-").join(",");t.tiles.forEach((function(e){if(e!==n){var o=e.split(",").join("-");a.combineGroups(t.groupID,o,n)}}))})),a.setState({loadingRoom:!1})},a.combineGroups=function(t,e,n){var o=a.groupCombiners[t],r=a.groupRefs[e];r&&o(document.getElementById(n),r.current,!1)},a.getRoomData=function(){return a.props.client.emit("getRoomData"),Object(o.jsx)("h1",{children:"Loading Room Data "})},a.moveGroup=function(t,e,n){var o=a.groupRefs[t];o.current.style.left=e,o.current.style.top=n},a.sendData=function(t){var e=Object.entries(a.groupRefs).map((function(t){var e=Object(p.a)(t,2),n=e[0],o=e[1];return{groupID:n,tiles:Object(l.a)(o.current.children).map((function(t){return t.id})),rotation:o.current.dataset.rotation,top:o.current.style.top,left:o.current.style.left}}));a.props.client.emit("returnRoomData",t,e)},a.saveGroupCombiner=function(t,e){a.groupCombiners[t]=e},a.state={loadingPicture:!0,loadingRoom:!0,groups:{}},a.groupCombiners={},a.groupRefs={},a}return Object(a.a)(n,[{key:"render",value:function(){if(this.state.loadingPicture){var t=Object(o.jsx)("img",{src:g,onLoad:this.doneLoadingPic});return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("h1",{children:"Loading Puzzle Tiles"}),t]})}return this.state.loadingRoom&&this.getRoomData(),Object(o.jsx)(o.Fragment,{children:Object.values(this.state.groups)})}}]),n}(f.Component),N=function(t){Object(i.a)(n,t);var e=Object(c.a)(n);function n(t){var o;return Object(r.a)(this,n),(o=e.call(this,t)).componentDidMount=function(){x=u.a.connect("https://puzzlooza.herokuapp.com/"),console.log("Attempting to connect..."),x.on("connect",(function(t){console.log("Connected to server. ID:",x.id),o.setState({connected:!0})}))},o.state={connected:!1},o}return Object(a.a)(n,[{key:"render",value:function(){return this.state.connected?Object(o.jsx)("div",{className:"App",children:Object(o.jsx)(I,{client:x})}):Object(o.jsx)("h1",{children:"Connecting to server..."})}}]),n}(f.Component),L=n(44),C=n.n(L);n(85);C.a.render(Object(o.jsx)(h.a.StrictMode,{children:Object(o.jsx)(N,{})}),document.getElementById("root"))}},[[86,1,2]]]);
//# sourceMappingURL=main.8a3a1716.chunk.js.map